# MPPI Reach And Avoid Simulation

- The following setup has been tested on a system with Ryzen 7 CPU, NVIDIA RTX 3050 GPU, and Ubuntu 22.04 OS.
- The planning algorithm can run upto 20hz.
- Used JAX for batch (`vmap`) and `jit` compatibility.
- Simulation Video in `non_ros/example_video` and `mppi_planner/example_video`
# Setup:
Assumes Cuda compatible hardware
## Docker Image Installation 
1. Install the Docker **Engine** [https://docs.docker.com/engine/install/](https://docs.docker.com/engine/install/)

Steps to create the Docker Image **mp_ros2**
1. From root of the directory  run  `./scripts/build/build.sh`


## To run the docker Conatiner

Steps to create a docker container **template** and will run it in a intractive mode

1. From root of the directory run `./scripts/deploy/devel.sh`

To launch multiple shells in docker container **template**, run the following
1. run `docker exec -it template bash` . This will attach the current terminal to the docker container template. 

## Steps to build the package

1. make sure you are in ros2 workspace. If you have followed above steps then currently you will be at `root/workspace/src/`
1. change the directory to `root/workspace/`
2. run `colcon build --symlink-install`


## Steps to run the simulation in simple python and Matplotlib simulation
1. run `cd root/workspace/src/non_ros`
2. run `python3 main.py`

### Discription of files
1. `main.py` : Main script to launch mppi function and visualization script
2. `dyn_visualization.py`: Script to simulate dynamics and visualization
3. `mppi.py`: Main logic for the mppi planner
4. `config/sim_config.yaml`: Configurations related to simulations, dynamics and mppi-planner

#### Note:
1. Obstacles, start, and goal positions can be randomly generated by changing the seed in `sim_config.yaml`
2. Currently, the start and goal are deterministically set and can be modified in `main.get_start_goal`


# Steps to run the simulation in ROS2
After building the package, run the following launch files
1. run `ros2 launch mppi_planner mppi_planner.launch.py`  
this will run the simulation node spawn the obstacles
2. run `ros2 run mppi_planner mppi_planner_node` 
this will run the mppi_planning_node.py which contains the mppi planning logic
### Discription of files
```
|-- config
|   |-- navigation.rviz
|   |-- sim_config.yaml
|-- launch
|   |-- mppi_planner.launch.py
|-- mppi_planner
|   |-- mppi_class.py
|   |-- mppi_planner_node.py
|   `-- spawn_cylinder.py

```
1. `mppi_planner.launch.py` : Launch file to run the simulation node spawn the obstacles
2. `mppi_class.py`: Script to run the mppi-planning algorithm
3. `spawn_cylinder.py`: Script to spawn the obstacles, included in launch file
3. `navigation.rviz`: Rviz Configuration
4. `sim_config.yaml`: Configurations related to simulations, dynamics and mppi-planner

#### Note:
1. Obstacles, goal positions are hard coded in  `mppi_planner/config/sim_config.yaml`
2. MPPI is aware of the all the static obstacles

## TO DO:
- [] Add Unit Test Cases
- [] Implement MPPI in C++
- [] Utilize the local costmap to generate motion plans using MPPI.
- [] CVar MPPI for stochastic dynamics



## License
MIT License (Non-Commercial)







## Author
[Prajwal Thakur](https://github.com/prajwalthakur) 

